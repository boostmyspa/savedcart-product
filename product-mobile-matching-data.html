<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="utf-8">
    <title>
        Glamour Baby Boutique
    </title>
    
    <base href="https://glamourbabyboutique.com">
    
    <!-- SEO Meta Tags-->
    <style type="text/css">
        .st0{fill: red !important;}
        .st1{fill: white !important;}
        .st2{fill: red !important;}
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="msapplication-TileColor" content="#111">
    <meta name="theme-color" content="#ffffff">
    <link rel="stylesheet" media="screen" href="https://glamourbabyboutique.com/static/store/css/vendor.min.css">
    <link rel="stylesheet" media="screen" id="main-styles" href="https://glamourbabyboutique.com/static/store/css/theme.css">
    <link rel="stylesheet" media="screen" id="main-styles" href="https://glamourbabyboutique.com/static/store/css/skins/theme-38b3a2-rounded.min.css">

    <style>
        [v-cloak] {
            display: none;
        }
        
        .fade-enter-active, .fade-leave-active {
            transition: opacity .2s;
        }

        .fade-enter, .fade-leave-to /* .fade-leave-active below version 2.1.8 */
        {
            opacity: 0;
        }
    </style>
    <style>
        @media (max-width: 768px) {
            h1 {
                font-size: 1.5rem;
            }
        }
    </style>
    <link rel="stylesheet" href="https://glamourbabyboutique.com/static/store/vue-loading.css">
</head>
<!-- Body-->
<body>


    <header class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid navbar-inner">
            <!-- navbar brand--><a class="navbar-brand" style="max-width: 125px;" href="/">
            Testing Page
        </a>
            <!-- navbar collapse area-->
            <div class="collapse navbar-collapse" id="menu">
                <!-- language/currency switcher-->

                <!-- Site menu-->
                <ul class="navbar-nav">
                </ul>


            </div>

        </div>
    </header>

<!-- Page Content-->
<!-- Hero slider-->
<div id="app">
    <div class="container pb-5" >
        <div class="row">
            <div class="col-12 pt-md-5 pt-2 d-none d-md-block">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb justify-content-center justify-content-md-start">
                        <li class="breadcrumb-item"><a href="#">SHOP</a></li>
                    </ol>
                </nav>
            </div>
            <div class="col-lg-6">
                <div class="product-gallery p-3 position-sticky" style="top:0;padding-left:0!important;">

                    <img src="https://placehold.it/600x600"/>

                </div>
                <!-- Related products (visible lg and up)-->

            </div>
            <!-- Product details column            -->
            <div class="col-lg-5 col-lg-offset-1">
                <!-- Product title and price (visible lg and up)-->

                <div class="card p-3 mb-3 " v-if="editting">

                    <h3>Let's Create Your Personalized Matching Set</h3>

                    <div id="question_top" v-cloak>
                        <div v-for="(grouping, grName, grIndex) in question_set" :key="grName">
                            <h6 class="mt-3" v-if="isGroupingShouldBeShown(grIndex)">[[ grouping.name ]]</h6>
                            
                            <transition-group name="fade" tag="div" mode="out-in">
                                <div v-if="isQuestionShouldBeShown(grIndex, qIndex)" v-for="(question, qTitle, qIndex) in grouping.attributes" :key="qTitle">
                                    <div class="form-group mb-1" v-if="question.type == 'C'">
                                        <label class="d-block">
                                            [[ question.question ]]
                                            <small style="display:block;color:red;" class="error" v-if="errors.has('image-'+question.question)">This field is required</small>
                                        </label>
        
                                        <div style="position: relative" v-if="question.answer[ORIGINAL_IMAGE]">
                                            <cropme ref="cropme" :image="question.answer[ORIGINAL_IMAGE]" :position-string="question.answer.params" stencil-image="https://glamourbabyboutique.com/media/product_images/mug-testing.png"
                                                    @crop="saveImageToAnswer(question.answer, $event)"></cropme>
                                            
                                            <button type="button" @click="removeImageFromAnswer(question.answer)" style="position: absolute; top: 0; right: 0; background: none; border: none">
                                                <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30" class="icon icon-remove" style="top: -7.5px; right: -7.5px;"><path d="M511.921231 0C229.179077 0 0 229.257846 0 512 0 794.702769 229.179077 1024 511.921231 1024 794.781538 1024 1024 794.702769 1024 512 1024 229.257846 794.781538 0 511.921231 0ZM732.041846 650.633846 650.515692 732.081231C650.515692 732.081231 521.491692 593.683692 511.881846 593.683692 502.429538 593.683692 373.366154 732.081231 373.366154 732.081231L291.761231 650.633846C291.761231 650.633846 430.316308 523.500308 430.316308 512.196923 430.316308 500.696615 291.761231 373.523692 291.761231 373.523692L373.366154 291.918769C373.366154 291.918769 503.453538 430.395077 511.881846 430.395077 520.349538 430.395077 650.515692 291.918769 650.515692 291.918769L732.041846 373.523692C732.041846 373.523692 593.447385 502.547692 593.447385 512.196923 593.447385 521.412923 732.041846 650.633846 732.041846 650.633846Z" fill="red"></path></svg>
                                            </button>
                                        </div>
                                        <input-image default-img="https://glamourbabyboutique.com/static/img/taptoupload.png" v-model="question.answer[ORIGINAL_IMAGE]" @uploading="imageWillBeUploaded = $event.then(id => question.answer.original_image = id)" v-else></input-image>
                                        <input type="hidden" :name="'image-'+question.question" v-model="question.answer[ORIGINAL_IMAGE]" v-validate="'required'">
                                        
                                        <button class="btn btn-primary btn-block px-5 mr-2" @click="cropAndGoToNextQuestion" v-if="isSaveButtonShouldBeShown(question.answer.original_image)">
                                            <i class="mr-2" data-feather="shopping-cart"></i>
                                            Saved & Next Step
                                        </button>
                                    </div>
    
                                    <div class="form-group mb-1" v-else-if="question.type == 'I'">
                                        <label class="d-block">
                                            [[ question.question ]]
                                            <small style="display:block;color:red;" class="error" v-if="errors.has('selection-'+question.question)">This field is required</small>
                                        </label>
                                        
                                        <div class="radio-tile-group" style="justify-content: left;">
                                            <div class="input-container" v-for="(answer, aIndex) in question.answers">
                                                <input class="radio-button" type="radio" :name="'selection-'+question.question" :value="aIndex" v-model="question.answer" v-validate="'required'" @change="goToNextQuestion({validate: false})"/>
                                                <div class="radio-tile">
                                                    <img :src="answer.image" style="max-width:95%;height:auto;margin:auto"/>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <button class="btn btn-primary btn-block px-5 mr-2" @click="goToNextQuestion" v-if="isSaveButtonShouldBeShown(question.answer)">
                                            <i class="mr-2" data-feather="shopping-cart"></i>
                                            Saved & Next Step
                                        </button>
                                    </div>
                                    
                                    <div class="form-group mb-1" v-else-if="question.type == 'R'">
                                        <label class="d-block">
                                            [[ question.question ]]
                                            <small style="display:block;color:red;" class="error" v-if="errors.has(qTitle)">This field is required</small>
                                        </label>
                                        
                                        <div class="custom-control custom-option custom-control-inline mb-2" v-for="(answer, aIndex) in question.answers">
                                            <input :id="qTitle+'-'+aIndex" class="custom-control-input" type="radio" :name="qTitle" :value="aIndex" v-model="question.answer" v-validate="'required'" @change="goToNextQuestion({validate: false})">
                                            <label :for="qTitle+'-'+aIndex" class="custom-option-label" style="background:white; ">
                                                <span class="custom-option-color" :style="{ backgroundColor: answer.title }"></span>
                                            </label>
                                        </div>
                                        
                                        <button class="btn btn-primary btn-block px-5 mr-2 mt-3" @click="goToNextQuestion" v-if="isMobile() && !isCurrentQuestionLast">
                                            <i class="mr-2" data-feather="shopping-cart"></i>
                                            Next Step
                                        </button>
                                    </div>
    
                                    <div class="form-group mb-1" v-else-if="question.type == 'S'">
                                        <label class="d-block">
                                            [[ question.question ]]
                                            <small style="display:block;color:red;" class="error" v-if="errors.has(qTitle)">This field is required</small>
                                        </label>
                                        
                                        <select class="form-control custom-select" id="select-input" v-model="question.answer">
                                            <option :name="qTitle" :value="aIndex" v-validate="'required'" v-for="(answer, aIndex) in question.answers" :key="aIndex">[[ answer.title ]]</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group mb-1" v-else-if="question.type == 'T'">
                                        <label class="d-block">
                                            [[ question.question ]] (Max 20 Letters)
                                            <small style="display:block;color:red;" class="error" v-if="errors.has(qTitle)">This field is required</small>
                                        </label>
                                        
                                        <input type="text" class="form-control" v-model="question.answer" :name="qTitle" v-validate="'required'" maxlength="20"/>
                                        
                                        <button class="btn btn-primary btn-block px-5 mr-2 mt-3" @click="goToNextQuestion" v-if="isMobile() && !isCurrentQuestionLast">
                                            <i class="mr-2" data-feather="shopping-cart"></i>
                                            Next Step
                                        </button>
                                    </div>
    
                                    <div class="form-group mb-1" v-else-if="question.type == 'V'">
                                        <label class="d-block">
                                            [[ question.question ]]
                                            <small style="display:block;color:red;" class="error" v-if="errors.has('selector-'+question.title)">This field is required</small>
                                        </label>
                                        
                                        <div class="radio-tile-group" style="justify-content: left;">
                                            <div class="input-container" v-for="(answer, aIndex) in question.answers">
                                                <input id="walk" class="radio-button" type="radio" :name="'selector-'+question.title" :value="answer" v-model="question.selection" v-validate="'required'"/>
                                                <div class="radio-tile">
                                                    <img :src="answer.image" style="max-width:95%;height:auto;margin:auto"/>
                                                </div>
                                            </div>
                                            <div style="width:100%;display:flex" v-if="question.selection">
                                                <label class="d-block" >
                                                    [[ question.selection.title ]]
                                                    <small style="display:block;color:red;" class="error" v-if="errors.has('selection-'+question.title)">This field is required</small>
                                                </label>
                                            </div>
                                            <div style="width:100%;display:flex" v-if="question.selection">
                                                <div class="input-container" v-for="(answer, aIndex) in question.selection.answers">
                                                    <input id="walk" class="radio-button" type="radio" :name="'selection-'+question.title" :value="aIndex" v-model="question.answer" v-validate="'required'" />
                                                    <div class="radio-tile">
                                                        <img :src="answer.image" style="max-width:95%;height:auto;margin:auto"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group mb-1" v-else-if="question.type == 'W'">
                                        <label class="d-block">
                                            [[ question.question ]]
                                            <small style="display:block;color:red;" class="error" v-if="errors.has(qTitle)">This field is required</small>
                                        </label>
                                        
                                        <select class="form-control custom-select" id="select-input" v-model="question.selection">
                                            <option :name="qTitle" :value="answer" v-validate="'required'" v-for="(answer, aIndex) in question.answers" :key="aIndex">[[ aIndex]]</option>
                                        </select>
                                        <div v-if="question.selection">
                                            [[ question.selection.answers ]]
                                            <label class="d-block">
                                                [[ question.selection.title ]]
                                                <small style="display:block;color:red;" class="error" v-if="errors.has(question.selection)">This field is required</small>
                                            </label>
                                            <select class="form-control custom-select" id="select-input" v-model="question.answer" >
                                                <option :name="question.selection" :value="aIndex" v-validate="'required'" v-for="(answer, aIndex) in question.selection.answers" :key="aIndex">[[ answer.title ]]</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </transition-group>
                        </div>
                        
                        <form ref="form" class="pb-4" method="POST" action="#" @submit="submitForm($event, 'prevent')" id="generateForm" ref="form">
                            <div class="d-flex flex-wrap pt-1">
                                <div v-if="!isMobile() || isCurrentQuestionLast">
                                    <button class="btn btn-primary btn-block px-5" type="submit"><i class="mr-2" data-feather="shopping-cart"></i>Update</button>
                                </div>
                            </div>
                            <div class="mt-3 text-center"><small><a class="btn btn-sm btn-outline-info" @click="editting=false" v-if="stored_data">Go back to selecting quantity →</a></small></div>
                            <input name="json" :value="inputJSON" type="hidden"/>
                        </form>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <div class="modal" tabindex="-1" role="dialog" id="modalSmall" data-keyboard="false" data-backdrop="static">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Creating Your Customization</h5>
                </div>
                <div class="modal-body">
                    <div class="progress mb-3">
                        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" :style="'width: '+percent+'%'" ></div>
                    </div>
                    <div class="list-group">
                        <a href="#" class="list-group-item list-group-item-action" v-if="percent > 0" :class="[(percent > 10) ? 'active':  'disabled']" >Preparing Your Custom Product</a>
                        <a href="#" class="list-group-item list-group-item-action" v-if="percent > 10" :class="[(percent > 20)? 'active':  'disabled']" >Grabbing the Necessary Supplies</a>
                        <a href="#" class="list-group-item list-group-item-action" v-if="percent > 20" :class="[(percent > 30)? 'active':   'disabled']" >Putting together your Custom Made Product</a>
                        <a href="#" class="list-group-item list-group-item-action" v-if="percent > 30" :class="[(percent > 30)? 'active':   'disabled']" >Preparing for Pictures</a>
                        <a href="#" class="list-group-item list-group-item-action" v-if="percent > 40" :class="[(percent > 40)? 'active':   'disabled']" >Calling the Photographer</a>
                        <a href="#" class="list-group-item list-group-item-action" v-if="percent > 50" :class="[(percent > 50)? 'active':   'disabled']" >Uploading the Pictures to the Server</a>
                        <a href="#" class="list-group-item list-group-item-action" v-if="percent > 60" :class="[(percent > 60)? 'active':   'disabled']" >Sending to the Dark Room</a>
                        <a href="#" class="list-group-item list-group-item-action" v-if="percent > 70" :class="[(percent > 70)? 'active':   'disabled']" >Waiting for it to develop...</a>
                        <a href="#" class="list-group-item list-group-item-action" v-if="percent > 80" :class="[(percent > 80)? 'active':   'disabled']" >Doing the Finishing Touches</a>
                        <a href="#" class="list-group-item list-group-item-action" v-if="percent > 90" :class="[(percent > 90)? 'active':   'disabled']" >All Set and just one more step.</a>
                        <a href="#" class="list-group-item list-group-item-action" v-if="percent > 95" :class="[(percent > 100)? 'active':   'disabled']" >Downloading the files....</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="https://glamourbabyboutique.com/static/store/js/vendor.min.js"></script>
<script type="text/javascript" src="https://glamourbabyboutique.com/static/store/js/theme.min.js"></script>
<script type="text/javascript" src="https://glamourbabyboutique.com/static/store/js/compiled-vue.js"></script>
<script type="text/javascript" src="https://glamourbabyboutique.com/static/store/vue-loading.js"></script>
<script>
    !function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.VueLazyload=t()}(this,function(){"use strict";function e(e){return e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function t(e){e=e||{};var t=arguments.length,i=0;if(1===t)return e;for(;++i<t;){var o=arguments[i];g(e)&&(e=o),r(o)&&n(e,o)}return e}function n(e,n){m(e,n);for(var o in n)if("__proto__"!==o&&i(n,o)){var a=n[o];r(a)?("undefined"===L(e[o])&&"function"===L(a)&&(e[o]=a),e[o]=t(e[o]||{},a)):e[o]=a}return e}function r(e){return"object"===L(e)||"function"===L(e)}function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function o(e,t){if(e.length){var n=e.indexOf(t);return n>-1?e.splice(n,1):void 0}}function a(e,t){for(var n=!1,r=0,i=e.length;r<i;r++)if(t(e[r])){n=!0;break}return n}function s(e,t){if("IMG"===e.tagName&&e.getAttribute("data-srcset")){var n=e.getAttribute("data-srcset"),r=[],i=e.parentNode,o=i.offsetWidth*t,a=void 0,s=void 0,u=void 0;n=n.trim().split(","),n.map(function(e){e=e.trim(),a=e.lastIndexOf(" "),-1===a?(s=e,u=999998):(s=e.substr(0,a),u=parseInt(e.substr(a+1,e.length-a-2),10)),r.push([u,s])}),r.sort(function(e,t){if(e[0]<t[0])return 1;if(e[0]>t[0])return-1;if(e[0]===t[0]){if(-1!==t[1].indexOf(".webp",t[1].length-5))return 1;if(-1!==e[1].indexOf(".webp",e[1].length-5))return-1}return 0});for(var d="",l=void 0,c=0;c<r.length;c++){l=r[c],d=l[1];var h=r[c+1];if(h&&h[0]<o){d=l[1];break}if(!h){d=l[1];break}}return d}}function u(e,t){for(var n=void 0,r=0,i=e.length;r<i;r++)if(t(e[r])){n=e[r];break}return n}function d(){if(!E)return!1;var e=!0,t=document;try{var n=t.createElement("object");n.type="image/webp",n.style.visibility="hidden",n.innerHTML="!",t.body.appendChild(n),e=!n.offsetWidth,t.body.removeChild(n)}catch(t){e=!1}return e}function l(e,t){var n=null,r=0;return function(){if(!n){var i=Date.now()-r,o=this,a=arguments,s=function(){r=Date.now(),n=!1,e.apply(o,a)};i>=t?s():n=setTimeout(s,t)}}}function c(e){return null!==e&&"object"===(void 0===e?"undefined":p(e))}function h(e){if(!(e instanceof Object))return[];if(Object.keys)return Object.keys(e);var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push(n);return t}function f(e){for(var t=e.length,n=[],r=0;r<t;r++)n.push(e[r]);return n}function v(){}var p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},b=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),g=function(e){return null==e||"function"!=typeof e&&"object"!==(void 0===e?"undefined":p(e))},m=function(e,t){if(null===e||void 0===e)throw new TypeError("expected first argument to be an object.");if(void 0===t||"undefined"==typeof Symbol)return e;if("function"!=typeof Object.getOwnPropertySymbols)return e;for(var n=Object.prototype.propertyIsEnumerable,r=Object(e),i=arguments.length,o=0;++o<i;)for(var a=Object(arguments[o]),s=Object.getOwnPropertySymbols(a),u=0;u<s.length;u++){var d=s[u];n.call(a,d)&&(r[d]=a[d])}return r},w=Object.prototype.toString,L=function(t){var n=void 0===t?"undefined":p(t);return"undefined"===n?"undefined":null===t?"null":!0===t||!1===t||t instanceof Boolean?"boolean":"string"===n||t instanceof String?"string":"number"===n||t instanceof Number?"number":"function"===n||t instanceof Function?void 0!==t.constructor.name&&"Generator"===t.constructor.name.slice(0,9)?"generatorfunction":"function":void 0!==Array.isArray&&Array.isArray(t)?"array":t instanceof RegExp?"regexp":t instanceof Date?"date":(n=w.call(t),"[object RegExp]"===n?"regexp":"[object Date]"===n?"date":"[object Arguments]"===n?"arguments":"[object Error]"===n?"error":"[object Promise]"===n?"promise":e(t)?"buffer":"[object Set]"===n?"set":"[object WeakSet]"===n?"weakset":"[object Map]"===n?"map":"[object WeakMap]"===n?"weakmap":"[object Symbol]"===n?"symbol":"[object Map Iterator]"===n?"mapiterator":"[object Set Iterator]"===n?"setiterator":"[object String Iterator]"===n?"stringiterator":"[object Array Iterator]"===n?"arrayiterator":"[object Int8Array]"===n?"int8array":"[object Uint8Array]"===n?"uint8array":"[object Uint8ClampedArray]"===n?"uint8clampedarray":"[object Int16Array]"===n?"int16array":"[object Uint16Array]"===n?"uint16array":"[object Int32Array]"===n?"int32array":"[object Uint32Array]"===n?"uint32array":"[object Float32Array]"===n?"float32array":"[object Float64Array]"===n?"float64array":"object")},_=t,E="undefined"!=typeof window,k=function(){return!!(E&&"IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&"intersectionRatio"in window.IntersectionObserverEntry.prototype)&&("isIntersecting"in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0}}),!0)}(),A={event:"event",observer:"observer"},j=function(){function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}if(E)return"function"==typeof window.CustomEvent?window.CustomEvent:(e.prototype=window.Event.prototype,e)}(),z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return E?window.devicePixelRatio||e:e},I=function(){if(E){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(e){}return e}}(),O={on:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];I?e.addEventListener(t,n,{capture:r,passive:!0}):e.addEventListener(t,n,r)},off:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.removeEventListener(t,n,r)}},T=function(e,t,n){var r=new Image;if(!e||!e.src){var i=new Error("image src is required");return n(i)}r.src=e.src,r.onload=function(){t({naturalHeight:r.naturalHeight,naturalWidth:r.naturalWidth,src:r.src})},r.onerror=function(e){n(e)}},S=function(e,t){return"undefined"!=typeof getComputedStyle?getComputedStyle(e,null).getPropertyValue(t):e.style[t]},x=function(e){return S(e,"overflow")+S(e,"overflow-y")+S(e,"overflow-x")},$=function(e){if(E){if(!(e instanceof HTMLElement))return window;for(var t=e;t&&t!==document.body&&t!==document.documentElement&&t.parentNode;){if(/(scroll|auto)/.test(x(t)))return t;t=t.parentNode}return window}},C=function(){function e(t){var n=t.max;y(this,e),this.options={max:n||100},this._caches=[]}return b(e,[{key:"has",value:function(e){return this._caches.indexOf(e)>-1}},{key:"add",value:function(e){this.has(e)||(this._caches.push(e),this._caches.length>this.options.max&&this.free())}},{key:"free",value:function(){this._caches.shift()}}]),e}(),H=function(){function e(t){var n=t.el,r=t.src,i=t.error,o=t.loading,a=t.bindType,s=t.$parent,u=t.options,d=t.elRenderer,l=t.imageCache;y(this,e),this.el=n,this.src=r,this.error=i,this.loading=o,this.bindType=a,this.attempt=0,this.naturalHeight=0,this.naturalWidth=0,this.options=u,this.rect=null,this.$parent=s,this.elRenderer=d,this._imageCache=l,this.performanceData={init:Date.now(),loadStart:0,loadEnd:0},this.filter(),this.initState(),this.render("loading",!1)}return b(e,[{key:"initState",value:function(){"dataset"in this.el?this.el.dataset.src=this.src:this.el.setAttribute("data-src",this.src),this.state={loading:!1,error:!1,loaded:!1,rendered:!1}}},{key:"record",value:function(e){this.performanceData[e]=Date.now()}},{key:"update",value:function(e){var t=e.src,n=e.loading,r=e.error,i=this.src;this.src=t,this.loading=n,this.error=r,this.filter(),i!==this.src&&(this.attempt=0,this.initState())}},{key:"getRect",value:function(){this.rect=this.el.getBoundingClientRect()}},{key:"checkInView",value:function(){return this.getRect(),this.rect.top<window.innerHeight*this.options.preLoad&&this.rect.bottom>this.options.preLoadTop&&this.rect.left<window.innerWidth*this.options.preLoad&&this.rect.right>0}},{key:"filter",value:function(){var e=this;h(this.options.filter).map(function(t){e.options.filter[t](e,e.options)})}},{key:"renderLoading",value:function(e){var t=this;this.state.loading=!0,T({src:this.loading},function(n){t.render("loading",!1),t.state.loading=!1,e()},function(){e(),t.state.loading=!1,t.options.silent||console.warn("VueLazyload log: load failed with loading image("+t.loading+")")})}},{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v;return this.attempt>this.options.attempt-1&&this.state.error?(this.options.silent||console.log("VueLazyload log: "+this.src+" tried too more than "+this.options.attempt+" times"),void t()):this.state.rendered&&this.state.loaded?void 0:this._imageCache.has(this.src)?(this.state.loaded=!0,this.render("loaded",!0),this.state.rendered=!0,t()):void this.renderLoading(function(){e.attempt++,e.options.adapter.beforeLoad&&e.options.adapter.beforeLoad(e,e.options),e.record("loadStart"),T({src:e.src},function(n){e.naturalHeight=n.naturalHeight,e.naturalWidth=n.naturalWidth,e.state.loaded=!0,e.state.error=!1,e.record("loadEnd"),e.render("loaded",!1),e.state.rendered=!0,e._imageCache.add(e.src),t()},function(t){!e.options.silent&&console.error(t),e.state.error=!0,e.state.loaded=!1,e.render("error",!1)})})}},{key:"render",value:function(e,t){this.elRenderer(this,e,t)}},{key:"performance",value:function(){var e="loading",t=0;return this.state.loaded&&(e="loaded",t=(this.performanceData.loadEnd-this.performanceData.loadStart)/1e3),this.state.error&&(e="error"),{src:this.src,state:e,time:t}}},{key:"$destroy",value:function(){this.el=null,this.src=null,this.error=null,this.loading=null,this.bindType=null,this.attempt=0}}]),e}(),Q="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",R=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],W={rootMargin:"0px",threshold:0},B=function(e){return function(){function t(e){var n=e.preLoad,r=e.error,i=e.throttleWait,o=e.preLoadTop,a=e.dispatchEvent,s=e.loading,u=e.attempt,c=e.silent,h=void 0===c||c,f=e.scale,v=e.listenEvents,p=(e.hasbind,e.filter),b=e.adapter,g=e.observer,m=e.observerOptions;y(this,t),this.version="1.3.3",this.mode=A.event,this.ListenerQueue=[],this.TargetIndex=0,this.TargetQueue=[],this.options={silent:h,dispatchEvent:!!a,throttleWait:i||200,preLoad:n||1.3,preLoadTop:o||0,error:r||Q,loading:s||Q,attempt:u||3,scale:f||z(f),ListenEvents:v||R,hasbind:!1,supportWebp:d(),filter:p||{},adapter:b||{},observer:!!g,observerOptions:m||W},this._initEvent(),this._imageCache=new C({max:200}),this.lazyLoadHandler=l(this._lazyLoadHandler.bind(this),this.options.throttleWait),this.setMode(this.options.observer?A.observer:A.event)}return b(t,[{key:"config",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};_(this.options,e)}},{key:"performance",value:function(){var e=[];return this.ListenerQueue.map(function(t){e.push(t.performance())}),e}},{key:"addLazyBox",value:function(e){this.ListenerQueue.push(e),E&&(this._addListenerTarget(window),this._observer&&this._observer.observe(e.el),e.$el&&e.$el.parentNode&&this._addListenerTarget(e.$el.parentNode))}},{key:"add",value:function(t,n,r){var i=this;if(a(this.ListenerQueue,function(e){return e.el===t}))return this.update(t,n),e.nextTick(this.lazyLoadHandler);var o=this._valueFormatter(n.value),u=o.src,d=o.loading,l=o.error;e.nextTick(function(){u=s(t,i.options.scale)||u,i._observer&&i._observer.observe(t);var o=Object.keys(n.modifiers)[0],a=void 0;o&&(a=r.context.$refs[o],a=a?a.$el||a:document.getElementById(o)),a||(a=$(t));var c=new H({bindType:n.arg,$parent:a,el:t,loading:d,error:l,src:u,elRenderer:i._elRenderer.bind(i),options:i.options,imageCache:i._imageCache});i.ListenerQueue.push(c),E&&(i._addListenerTarget(window),i._addListenerTarget(a)),i.lazyLoadHandler(),e.nextTick(function(){return i.lazyLoadHandler()})})}},{key:"update",value:function(t,n,r){var i=this,o=this._valueFormatter(n.value),a=o.src,d=o.loading,l=o.error;a=s(t,this.options.scale)||a;var c=u(this.ListenerQueue,function(e){return e.el===t});c?c.update({src:a,loading:d,error:l}):this.add(t,n,r),this._observer&&(this._observer.unobserve(t),this._observer.observe(t)),this.lazyLoadHandler(),e.nextTick(function(){return i.lazyLoadHandler()})}},{key:"remove",value:function(e){if(e){this._observer&&this._observer.unobserve(e);var t=u(this.ListenerQueue,function(t){return t.el===e});t&&(this._removeListenerTarget(t.$parent),this._removeListenerTarget(window),o(this.ListenerQueue,t),t.$destroy())}}},{key:"removeComponent",value:function(e){e&&(o(this.ListenerQueue,e),this._observer&&this._observer.unobserve(e.el),e.$parent&&e.$el.parentNode&&this._removeListenerTarget(e.$el.parentNode),this._removeListenerTarget(window))}},{key:"setMode",value:function(e){var t=this;k||e!==A.observer||(e=A.event),this.mode=e,e===A.event?(this._observer&&(this.ListenerQueue.forEach(function(e){t._observer.unobserve(e.el)}),this._observer=null),this.TargetQueue.forEach(function(e){t._initListen(e.el,!0)})):(this.TargetQueue.forEach(function(e){t._initListen(e.el,!1)}),this._initIntersectionObserver())}},{key:"_addListenerTarget",value:function(e){if(e){var t=u(this.TargetQueue,function(t){return t.el===e});return t?t.childrenCount++:(t={el:e,id:++this.TargetIndex,childrenCount:1,listened:!0},this.mode===A.event&&this._initListen(t.el,!0),this.TargetQueue.push(t)),this.TargetIndex}}},{key:"_removeListenerTarget",value:function(e){var t=this;this.TargetQueue.forEach(function(n,r){n.el===e&&(--n.childrenCount||(t._initListen(n.el,!1),t.TargetQueue.splice(r,1),n=null))})}},{key:"_initListen",value:function(e,t){var n=this;this.options.ListenEvents.forEach(function(r){return O[t?"on":"off"](e,r,n.lazyLoadHandler)})}},{key:"_initEvent",value:function(){var e=this;this.Event={listeners:{loading:[],loaded:[],error:[]}},this.$on=function(t,n){e.Event.listeners[t]||(e.Event.listeners[t]=[]),e.Event.listeners[t].push(n)},this.$once=function(t,n){function r(){i.$off(t,r),n.apply(i,arguments)}var i=e;e.$on(t,r)},this.$off=function(t,n){if(!n){if(!e.Event.listeners[t])return;return void(e.Event.listeners[t].length=0)}o(e.Event.listeners[t],n)},this.$emit=function(t,n,r){e.Event.listeners[t]&&e.Event.listeners[t].forEach(function(e){return e(n,r)})}}},{key:"_lazyLoadHandler",value:function(){var e=this,t=[];this.ListenerQueue.forEach(function(e,n){e.el&&e.el.parentNode||t.push(e),e.checkInView()&&e.load()}),t.forEach(function(t){o(e.ListenerQueue,t),t.$destroy()})}},{key:"_initIntersectionObserver",value:function(){var e=this;k&&(this._observer=new IntersectionObserver(this._observerHandler.bind(this),this.options.observerOptions),this.ListenerQueue.length&&this.ListenerQueue.forEach(function(t){e._observer.observe(t.el)}))}},{key:"_observerHandler",value:function(e,t){var n=this;e.forEach(function(e){e.isIntersecting&&n.ListenerQueue.forEach(function(t){if(t.el===e.target){if(t.state.loaded)return n._observer.unobserve(t.el);t.load()}})})}},{key:"_elRenderer",value:function(e,t,n){if(e.el){var r=e.el,i=e.bindType,o=void 0;switch(t){case"loading":o=e.loading;break;case"error":o=e.error;break;default:o=e.src}if(i?r.style[i]='url("'+o+'")':r.getAttribute("src")!==o&&r.setAttribute("src",o),r.setAttribute("lazy",t),this.$emit(t,e,n),this.options.adapter[t]&&this.options.adapter[t](e,this.options),this.options.dispatchEvent){var a=new j(t,{detail:e});r.dispatchEvent(a)}}}},{key:"_valueFormatter",value:function(e){var t=e,n=this.options.loading,r=this.options.error;return c(e)&&(e.src||this.options.silent||console.error("Vue Lazyload warning: miss src with "+e),t=e.src,n=e.loading||this.options.loading,r=e.error||this.options.error),{src:t,loading:n,error:r}}}]),t}()},D=function(e){return{props:{tag:{type:String,default:"div"}},render:function(e){return!1===this.show?e(this.tag):e(this.tag,null,this.$slots.default)},data:function(){return{el:null,state:{loaded:!1},rect:{},show:!1}},mounted:function(){this.el=this.$el,e.addLazyBox(this),e.lazyLoadHandler()},beforeDestroy:function(){e.removeComponent(this)},methods:{getRect:function(){this.rect=this.$el.getBoundingClientRect()},checkInView:function(){return this.getRect(),E&&this.rect.top<window.innerHeight*e.options.preLoad&&this.rect.bottom>0&&this.rect.left<window.innerWidth*e.options.preLoad&&this.rect.right>0},load:function(){this.show=!0,this.state.loaded=!0,this.$emit("show",this)},destroy:function(){return this.$destroy}}}},V=function(){function e(t){var n=t.lazy;y(this,e),this.lazy=n,n.lazyContainerMananger=this,this._queue=[]}return b(e,[{key:"bind",value:function(e,t,n){var r=new P({el:e,binding:t,vnode:n,lazy:this.lazy});this._queue.push(r)}},{key:"update",value:function(e,t,n){var r=u(this._queue,function(t){return t.el===e});r&&r.update({el:e,binding:t,vnode:n})}},{key:"unbind",value:function(e,t,n){var r=u(this._queue,function(t){return t.el===e});r&&(r.clear(),o(this._queue,r))}}]),e}(),N={selector:"img"},P=function(){function e(t){var n=t.el,r=t.binding,i=t.vnode,o=t.lazy;y(this,e),this.el=null,this.vnode=i,this.binding=r,this.options={},this.lazy=o,this._queue=[],this.update({el:n,binding:r})}return b(e,[{key:"update",value:function(e){var t=this,n=e.el,r=e.binding;this.el=n,this.options=_({},N,r.value),this.getImgs().forEach(function(e){t.lazy.add(e,_({},t.binding,{value:{src:"dataset"in e?e.dataset.src:e.getAttribute("data-src"),error:("dataset"in e?e.dataset.error:e.getAttribute("data-error"))||t.options.error,loading:("dataset"in e?e.dataset.loading:e.getAttribute("data-loading"))||t.options.loading}}),t.vnode)})}},{key:"getImgs",value:function(){return f(this.el.querySelectorAll(this.options.selector))}},{key:"clear",value:function(){var e=this;this.getImgs().forEach(function(t){return e.lazy.remove(t)}),this.vnode=null,this.binding=null,this.lazy=null}}]),e}(),M=function(e){return{props:{src:[String,Object],tag:{type:String,default:"img"}},render:function(e){return e(this.tag,{attrs:{src:this.renderSrc}},this.$slots.default)},data:function(){return{el:null,options:{src:"",error:"",loading:"",attempt:e.options.attempt},state:{loaded:!1,error:!1,attempt:0},rect:{},renderSrc:""}},watch:{src:function(){this.init(),e.addLazyBox(this),e.lazyLoadHandler()}},created:function(){this.init(),this.renderSrc=this.options.loading},mounted:function(){this.el=this.$el,e.addLazyBox(this),e.lazyLoadHandler()},beforeDestroy:function(){e.removeComponent(this)},methods:{init:function(){var t=e._valueFormatter(this.src),n=t.src,r=t.loading,i=t.error;this.state.loaded=!1,this.options.src=n,this.options.error=i,this.options.loading=r,this.renderSrc=this.options.loading},getRect:function(){this.rect=this.$el.getBoundingClientRect()},checkInView:function(){return this.getRect(),E&&this.rect.top<window.innerHeight*e.options.preLoad&&this.rect.bottom>0&&this.rect.left<window.innerWidth*e.options.preLoad&&this.rect.right>0},load:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v;if(this.state.attempt>this.options.attempt-1&&this.state.error)return e.options.silent||console.log("VueLazyload log: "+this.options.src+" tried too more than "+this.options.attempt+" times"),void n();var r=this.options.src;T({src:r},function(e){var n=e.src;t.renderSrc=n,t.state.loaded=!0},function(e){t.state.attempt++,t.renderSrc=t.options.error,t.state.error=!0})}}}};return{install:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=B(e),r=new n(t),i=new V({lazy:r}),o="2"===e.version.split(".")[0];e.prototype.$Lazyload=r,t.lazyComponent&&e.component("lazy-component",D(r)),t.lazyImage&&e.component("lazy-image",M(r)),o?(e.directive("lazy",{bind:r.add.bind(r),update:r.update.bind(r),componentUpdated:r.lazyLoadHandler.bind(r),unbind:r.remove.bind(r)}),e.directive("lazy-container",{bind:i.bind.bind(i),componentUpdated:i.update.bind(i),unbind:i.unbind.bind(i)})):(e.directive("lazy",{bind:r.lazyLoadHandler.bind(r),update:function(e,t){_(this.vm.$refs,this.vm.$els),r.add(this.el,{modifiers:this.modifiers||{},arg:this.arg,value:e,oldValue:t},{context:this.vm})},unbind:function(){r.remove(this.el)}}),e.directive("lazy-container",{update:function(e,t){i.update(this.el,{modifiers:this.modifiers||{},arg:this.arg,value:e,oldValue:t},{context:this.vm})},unbind:function(){i.unbind(this.el)}}))}}});
</script>
{# CSRF Token Script #}
<script>function getCookie(e){var o=null;if(document.cookie&&""!==document.cookie)for(var t=document.cookie.split(";"),n=0;n<t.length;n++){var r=t[n].trim();if(r.substring(0,e.length+1)===e+"="){o=decodeURIComponent(r.substring(e.length+1));break}}return o}var csrftoken=getCookie("csrftoken");
</script>
</body>
</html>
<script>
    // {# I have used to force the form clear, doesn't really work #}
    window.onpageshow = function(event) {
        if (event.persisted) {
            vm.$forceUpdate();
        }
    };
</script>
<script src="https://cdn.jsdelivr.net/npm/babel-polyfill/dist/polyfill.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vuetify@1.1.6/dist/vuetify.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/boostmyspa/cropme@handles/dist/cropme.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/boostmyspa/cropme@handles/dist/cropme.min.css">
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    const IMAGES_API = 'https://glamourbabyboutique.com/api-cart/images';
    
    function generateUID() {
        return Math.ceil(Math.random() * Number.MAX_SAFE_INTEGER).toString(36);
    }
    function isDummyEqual(a, b) {
        return (a === b) || (JSON.stringify(a) === JSON.stringify(b));
    }
    
    Vue.use(VeeValidate);
    Vue.component('cropme', {
        template: `<div ref="root"></div>`,
        props: ['image', 'positionString', 'stencilImage'],
        data() {
            return {
                instance: null
            };
        },
        methods: {
            crop(options) {
                return this.instance.crop(options || {type: 'base64'}).then(result => {
                    this.$emit('crop', {
                        image: result,
                        params: {
                            position: this.instance.position(),
                            viewport: {
                                height: this.instance.options.viewport.height,
                                width:  this.instance.options.viewport.width
                            }
                        }
                    });
                    return result;
                });
            }
        },
        mounted() {
            const options = {
                width:  300,
                height: 300,
                zoom: {
                    enable:     true,
                    mouseWheel: true,
                    slider:     true
                },
                rotation: {
                    enable:   true,
                    slider:   true,
                    position: 'left'
                }
            };
            if (this.positionString) {
                const viewportOptions = this.positionString.viewport;
                if (viewportOptions) {
                    if (!options.viewport) options.viewport = {};
    
                    options.viewport.height = viewportOptions.height;
                    options.viewport.width  = viewportOptions.width;
                }
            }
            
            this.instance = new Cropme(this.$el, options);
            this.instance.bind({
                url:      this.image,
                position: this.positionString ? this.positionString.position : {}
            });
            
            if (this.stencilImage) {
                const $viewport = this.$refs.root.querySelector('.viewport');
                if ($viewport) {
                    $viewport.style = `background: url('${this.stencilImage}'); background-size: contain`;
                }
            }
        }
    });
    Vue.component('input-image', {
        template: `
            <div :class="{active: isDragging || isProcessing}">
                <label :for="id" style="position: relative">
                    <div>
                        <img :src="value || defaultImg">
                    </div>
                    <div @dragenter="isDragging = true" @dragleave="isDragging = false"
                         @dragover.prevent @drop.prevent="handleDnD"
                        style="position: absolute; top: 0; right: 0; bottom: 0; left: 0; cursor: pointer">
                    </div>
                </label>
                <input type="file" :id="id" ref="file" @change="handleInput" style="display: none">
            </div>
        `,
        props: ['value', 'defaultImg'],
        data() {
            return {
                isDragging:   false,
                isProcessing: false
            };
        },
        computed: {
            id() {
                return 'input-image-' + generateUID();
            }
        },
        methods: {
            handleDnD(ev) {
                if (ev.dataTransfer.items) {
                    const item = ev.dataTransfer.items[0];
                    if (item.kind !== 'file') return;
                
                    this.process(item.getAsFile());
                } else {
                    const file = ev.dataTransfer.files[0];
                    this.process(file);
                }
                this.isDragging = false;
            },
            handleInput() {
                const file = this.$refs.file.files[0];
                if (!file) return;
            
                this.process(file);
            },
            process(file) {
                const data = new FormData();
                data.append('image', file);
                const promise = axios.post(IMAGES_API, data).then(({data: {id}}) => id);
                this.$emit('uploading', promise);
                
                var reader = new FileReader();
                reader.addEventListener('load', () => {
                    this.$emit('input', reader.result);
                });
                reader.readAsDataURL(file);
            }
        }
    });
    const app = new Vue({
        el: '#app',
        delimiters: ['[[', ']]'],
        data() {
            return {
                ORIGINAL_IMAGE: Symbol('Original image file'),
                imageWillBeUploaded: null,
                
                breadcrumbs: [0, 0],
                custom_1: 'S',
                custom_2: 'NB',
                custom_3: 'NB',
                custom_4: 'S',
                custom_5: 'NB',
                percent: 0,
                editting: true,
                background: '',
                color: '',
                preload: '',
                initial: null,
                /*
                * Question types:
                * C - Crop an image
                * I - Select an image
                * R - Select a color
                * S - Select from a list
                * T - Type a text
                * V - Select an image with ?
                * W - Select from a list with ?
                */
                question_set: {
                    MugCreator: { // a grouping
                        name: 'MugCreator',
                        attributes: {
                            'Upload a Picture': { // a question
                                question: 'Upload a Picture',
                                answer: {
                                    original_image: '',
                                    params:         ''
                                },
                                type: 'C'
                            },
                            'Select a Style': {
                                answers: {
                                    '147': {
                                        title: '1',
                                        image: '/media/processing/mug-testing_Y6wdZPv.png'
                                    }
                                },
                                question:  'Select a Style',
                                answer:    '',
                                selection: '',
                                type:      'I'
                            }
                        }
                    }
                },
                stored_data: ''
            }
        },
        computed: {
            currentGrouping() {
                return Object.values(this.question_set)[this.breadcrumbs[0]];
            },
            currentQuestion() {
                return Object.values(this.currentGrouping.attributes)[this.breadcrumbs[1]];
            },
    
            isCurrentGroupingLast() {
                return this.breadcrumbs[0] === this.lastStep[0];
            },
            isCurrentQuestionLastInCurrentGrouping() {
                return this.breadcrumbs[1] === (Object.keys(this.currentGrouping.attributes).length - 1);
            },
            isCurrentQuestionLast() {
                return isDummyEqual(this.breadcrumbs, this.lastStep);
            },
            
            lastStep: function() {
                const grNames = Object.keys(this.question_set);
                const qNames  = Object.keys(this.question_set[grNames[grNames.length-1]].attributes);
                
                return [grNames.length-1, qNames.length-1];
            },
            inputJSON: function() {
                const strippedQuestionSet = {};
                for (const [grName, grouping] of Object.entries(this.question_set)) {
                    strippedQuestionSet[grName] = {
                        attributes: {}
                    };
                    
                    for (const [qName, question] of Object.entries(grouping.attributes)) {
                        strippedQuestionSet[grName].attributes[qName] = question.answer;
                    }
                }
                
                return JSON.stringify({
                    background: this.background.replace("rgb", ""),
                    color:      this.color     .replace("rgb", ""),
                    ...strippedQuestionSet
                });
            }
        },
        methods: {
            isGroupingShouldBeShown(groupingIndex) {
                return !this.isMobile() || (groupingIndex == this.breadcrumbs[0]);
            },
            isQuestionShouldBeShown(groupingIndex, questionIndex) {
                return !this.isMobile() || isDummyEqual([groupingIndex, questionIndex], this.breadcrumbs);
            },
            isSaveButtonShouldBeShown(condition) {
                return condition && this.isMobile() && !this.isCurrentQuestionLast && this.currentQuestion.answer;
            },
            
            goToNextGrouping() {
                if (this.isCurrentGroupingLast) {
                    this.submitForm();
                } else {
                    this.$set(this.breadcrumbs, 0, this.breadcrumbs[0]+1);
                    this.$set(this.breadcrumbs, 1, 0);
                }
            },
            async goToNextQuestion({validate = true} = {}) {
                try {
                    if (!validate || await this.$validator.validateAll()) {
                        if (this.isCurrentQuestionLastInCurrentGrouping) {
                            this.goToNextGrouping();
                        } else {
                            this.$set(this.breadcrumbs, 1, this.breadcrumbs[1]+1);
                        }
                    }
                } catch (e) {
                    console.log(e);
                }
                
                document.getElementById("question_top").scrollIntoView();
            },
    
            async cropAndGoToNextQuestion() {
                await this.$refs.cropme[0].crop();
                this.goToNextQuestion();
            },
            
            loader() {
                this.percent += 10;
                console.log(this.percent)
            },
            
            isMobile() {
                return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            },
            
            removeImageFromAnswer(answer) {
                answer.original_image       = null;
                answer[this.ORIGINAL_IMAGE] = null;
                answer.params               = null;
            },
            saveImageToAnswer(answer, result) {
                answer.params = result.params;
            },
            async submitForm(ev, prevent) {
                if (ev && prevent) ev.preventDefault();
                
                $('#modalSmall').modal('show');
                this.percent = 0;
                [300, 400, 700, 1000, 8000, 10000, 13000, 16000, 18000, 20000].forEach(delay => setTimeout(this.loader, delay));
                
                await this.imageWillBeUploaded;
                try {
                    if (await this.$validator.validateAll()) {
                        if (this.$refs.cropme && this.$refs.cropme[0]) await this.$refs.cropme[0].crop();
                        this.$refs.form.submit();
                    }
                } catch (e) {
                    console.log(e);
                    $('#modalSmall').modal('hide')
                }
            },
            updateBg: function(color){
                this.background = color;
            },
            updateColor: function(color){
                this.color = color;
            }
        },
        mounted() {
            if (this.stored_data) {
                if ('color' in this.stored_data) {
                    this.color = this.stored_data.color;
                    $('#txtclor').attr('color', this.color.replace('\(','').replace('\)','').replace(' ',''));
                }
                if ('background' in this.stored_data){
                    this.background = this.stored_data.background;
                    $('#bgcolor').attr('color', this.background.replace('\(','').replace('\)','').replace(' ',''));
                }
                
                for (const [grName, grouping] of Object.entries(this.question_set)) {
                    for (const [qName, question] of Object.entries(grouping.attributes)) {
                        question.answer = this.stored_data[grName].attributes[qName];
                    
                        if ('answers' in question) {
                            for (const answer of Object.values(question.answers)) {
                                if ('answers' in answer) {
                                    if (this.stored_data[grName].attributes[qName] in answer.answers) {
                                        question.selection = answer;
                                    }
                                }
                            }
                        }
                        if (question.type == 'C') {
                            console.log('yes');
                            Vue.set(this, 'initial', '/pdo/' + this.stored_data[grName].attributes[qName]);
                        }
                    }
                }
            }
            if (this.preload) {
                console.log('yes');
                for (const [grName, grouping] of Object.entries(this.question_set)) {
                    console.log(grName);
                    if (grName in this.preload) {
                        console.log('true');
                        for (const [qName, question] of Object.entries(grouping.attributes)) {
                            console.log(qName);
                            if (qName in this.preload[grName].attributes) {
                                console.log('found')
                                question.answer  = this.preload[grName].attributes[qName];
                                question.preload = true;
                            }
                            else {
                                question.preload = false;
                            }
                        }
                    }
                }
            }
        }
    });
</script>
